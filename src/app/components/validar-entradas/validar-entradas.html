<div class="validar-entradas-container">
  <!-- HEADER -->
  <header class="header">
    <h1>ğŸ« ValidaciÃ³n de Entradas</h1>
    <p class="subtitulo">En BelÃ©n de JudÃ¡ - Musical</p>
  </header>

  <!-- ESTADÃSTICAS -->
  <section class="estadisticas" *ngIf="estadisticas">
    <div class="stat-card">
      <div class="stat-numero">{{ estadisticas.totalEntradas }}</div>
      <div class="stat-label">Total Vendidas</div>
    </div>
    <div class="stat-card validadas">
      <div class="stat-numero">{{ estadisticas.entradasValidadas }}</div>
      <div class="stat-label">Validadas</div>
    </div>
    <div class="stat-card pendientes">
      <div class="stat-numero">{{ estadisticas.entradasPendientes }}</div>
      <div class="stat-label">Pendientes</div>
    </div>
    <div class="stat-card porcentaje">
      <div class="stat-numero">{{ estadisticas.porcentajeValidado }}%</div>
      <div class="stat-label">Completado</div>
    </div>
  </section>

  <!-- FORMULARIO DE VALIDACIÃ“N -->
  <section class="validacion-form">
    <h2>Escanear o Ingresar CÃ³digo</h2>
    
    <!-- BotÃ³n grande para activar escÃ¡ner -->
    <button 
      *ngIf="!escaneandoQR"
      class="btn-escanear-grande" 
      (click)="activarEscanerQR()"
      [disabled]="validando"
    >
      ğŸ“· ESCANEAR CÃ“DIGO QR
    </button>

    <!-- Lector de QR (se muestra cuando estÃ¡ escaneando) -->
    <div *ngIf="escaneandoQR" class="qr-reader-container">
      <div id="qr-reader"></div>
      <button class="btn-cancelar-escaner" (click)="detenerEscaner()">
        âœ– Cancelar Escaneo
      </button>
      <p class="instruccion-escaner">Apunta la cÃ¡mara al cÃ³digo QR de la entrada</p>
    </div>

    <!-- Separador -->
    <div class="separador" *ngIf="!escaneandoQR">
      <span>O ingresa manualmente</span>
    </div>
    
    <div class="input-group" *ngIf="!escaneandoQR">
      <input 
        type="text" 
        [(ngModel)]="ticketId" 
        placeholder="BELEN-XXXXX-XXXXX"
        class="ticket-input"
        (keyup.enter)="validarEntrada()"
        [disabled]="validando"
        autofocus
      />
    </div>

    <div class="botones" *ngIf="!escaneandoQR">
      <button 
        class="btn-validar" 
        (click)="validarEntrada()"
        [disabled]="validando || !ticketId.trim()"
      >
        <span *ngIf="!validando">âœ“ Validar Entrada</span>
        <span *ngIf="validando">â³ Validando...</span>
      </button>

      <button 
        class="btn-consultar" 
        (click)="consultarEntrada()"
        [disabled]="validando || !ticketId.trim()"
      >
        ğŸ” Solo Consultar
      </button>

      <button 
        class="btn-limpiar" 
        (click)="limpiarResultado()"
        [disabled]="validando"
      >
        ğŸ—‘ï¸ Limpiar
      </button>
    </div>
  </section>

  <!-- RESULTADO DE VALIDACIÃ“N -->
  <section class="resultado" *ngIf="resultado" [ngClass]="getResultadoClass()">
    <div class="resultado-header">
      <span class="resultado-icono">{{ getResultadoIcono() }}</span>
      <h3>{{ resultado.message || resultado.error }}</h3>
    </div>

    <div class="resultado-detalles" *ngIf="resultado.detalles">
      <div class="detalle-row">
        <span class="label">Ticket ID:</span>
        <span class="valor codigo">{{ resultado.ticketId }}</span>
      </div>

      <div class="detalle-row">
        <span class="label">Cliente:</span>
        <span class="valor">{{ resultado.detalles.nombreCliente }}</span>
      </div>

      <div class="detalle-row">
        <span class="label">Email:</span>
        <span class="valor">{{ resultado.detalles.emailCliente }}</span>
      </div>

      <div class="detalle-row">
        <span class="label">SesiÃ³n:</span>
        <span class="valor">
          {{ resultado.detalles.sesion.fecha }} - {{ resultado.detalles.sesion.hora }}
        </span>
      </div>

      <div class="detalle-row">
        <span class="label">Lugar:</span>
        <span class="valor">{{ resultado.detalles.sesion.lugar }}</span>
      </div>

      <div class="detalle-row">
        <span class="label">Entradas:</span>
        <span class="valor">
          {{ resultado.detalles.totalEntradas }}
          ({{ resultado.detalles.entradasAdultos }} adultos, 
          {{ resultado.detalles.entradasNinos }} niÃ±os)
        </span>
      </div>

      <div class="detalle-row">
        <span class="label">Importe Total:</span>
        <span class="valor destacado">{{ resultado.detalles.importeTotal }}â‚¬</span>
      </div>

      <div class="detalle-row">
        <span class="label">Fecha de Compra:</span>
        <span class="valor">{{ formatearFecha(resultado.detalles.fechaCompra) }}</span>
      </div>

      <div class="detalle-row" *ngIf="resultado.detalles.fechaValidacion">
        <span class="label">Validada el:</span>
        <span class="valor">{{ formatearFecha(resultado.detalles.fechaValidacion) }}</span>
      </div>
    </div>
  </section>

  <!-- HISTORIAL -->
  <section class="historial" *ngIf="historial.length > 0">
    <h2>ğŸ“‹ Ãšltimas Validaciones</h2>
    <div class="historial-lista">
      <div 
        class="historial-item" 
        *ngFor="let item of historial.slice(0, 10)"
        [ngClass]="{ 'validada': item.code === 'TICKET_VALIDATED' }"
      >
        <div class="historial-icono">{{ item.code === 'TICKET_VALIDATED' ? 'âœ…' : 'âš ï¸' }}</div>
        <div class="historial-info">
          <div class="historial-ticket">{{ item.ticketId }}</div>
          <div class="historial-cliente" *ngIf="item.detalles">
            {{ item.detalles.nombreCliente }} - {{ item.detalles.totalEntradas }} entrada(s)
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MODO ESCANEO QR ya no es necesario, se maneja arriba -->
</div>
