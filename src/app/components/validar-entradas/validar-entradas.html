<div class="validar-entradas-container">
  <!-- HEADER -->
  <header class="header">
    <h1>ğŸ« ValidaciÃ³n de Entradas</h1>
    <p class="subtitulo">En BelÃ©n De JudÃ¡ - Musical</p>
  </header>

  <!-- FORMULARIO DE VALIDACIÃ“N - SOLO ESCANEO QR -->
  <section class="validacion-form">
    <h2>Escanear CÃ³digo QR</h2>
    
    <!-- BotÃ³n grande para activar escÃ¡ner -->
    <button 
      *ngIf="!escaneandoQR"
      class="btn-escanear-grande" 
      (click)="activarEscanerQR()"
      [disabled]="validando"
    >
      ğŸ“· INICIAR ESCANEO DE ENTRADAS
    </button>

    <!-- Lector de QR (se muestra cuando estÃ¡ escaneando) -->
    <div *ngIf="escaneandoQR" class="qr-reader-container">
      <div id="qr-reader"></div>
      <button class="btn-cancelar-escaner" (click)="detenerEscaner()">
        âœ– Finalizar Escaneo
      </button>
      <p class="instruccion-escaner" *ngIf="!escanerPausado">
        Apunta la cÃ¡mara al cÃ³digo QR de la entrada<br>
        <small>âœ… Entradas escaneadas: <strong>{{ contadorEscaneos }}</strong></small>
      </p>
      <p class="instruccion-escaner pausado" *ngIf="escanerPausado">
        â¸ï¸ EscÃ¡ner pausado - Confirma el resultado para continuar<br>
        <small>âœ… Entradas escaneadas: <strong>{{ contadorEscaneos }}</strong></small>
      </p>
    </div>

    <p class="info-escaner" *ngIf="!escaneandoQR">
      ğŸ‘† Pulsa el botÃ³n para activar la cÃ¡mara y comenzar a validar entradas
    </p>
  </section>

  <!-- ESTADÃSTICAS -->
  <section class="estadisticas" *ngIf="estadisticas">
    <div class="stat-card">
      <div class="stat-numero">{{ estadisticas.totalEntradas }}</div>
      <div class="stat-label">Total Vendidas</div>
    </div>
    <div class="stat-card validadas">
      <div class="stat-numero">{{ estadisticas.entradasValidadas }}</div>
      <div class="stat-label">Validadas</div>
    </div>
    <div class="stat-card pendientes">
      <div class="stat-numero">{{ estadisticas.entradasPendientes }}</div>
      <div class="stat-label">Pendientes</div>
    </div>
    <div class="stat-card porcentaje">
      <div class="stat-numero">{{ estadisticas.porcentajeValidado }}%</div>
      <div class="stat-label">Completado</div>
    </div>
  </section>

  <!-- BACKDROP Y NOTIFICACIÃ“N FLOTANTE DE RESULTADO (cuando se escanea QR) -->
  <div class="notificacion-backdrop" 
       *ngIf="mostrarNotificacion && resultado"
       [@slideInOut]
       (click)="cerrarNotificacion()">
  </div>
  
  <div class="notificacion-flotante" 
       *ngIf="mostrarNotificacion && resultado"
       [ngClass]="getNotificacionClass()"
       [@slideInOut]>
    <div class="notificacion-contenido">
      
      <div class="notificacion-icono">{{ getResultadoIcono() }}</div>
      
      <h2 class="notificacion-titulo">{{ getNotificacionTitulo() }}</h2>
      
      <div class="notificacion-detalles" *ngIf="resultado.detalles">
        <p class="ticket-id">{{ resultado.ticketId }}</p>
        <p class="cliente-nombre">{{ resultado.detalles.nombreCliente }}</p>
        <p class="entradas-info">
          <strong>{{ resultado.detalles.totalEntradas }}</strong> 
          {{ resultado.detalles.totalEntradas === 1 ? 'entrada' : 'entradas' }} en total
        </p>
        <p class="validacion-info" *ngIf="resultado.code === 'TICKET_VALIDATED'">
          <span class="badge-validadas">âœ“ Todas las entradas de este QR han sido validadas</span>
        </p>
        <p class="validacion-info" *ngIf="resultado.code === 'TICKET_ALREADY_USED'">
          <span class="badge-ya-validadas">âš  Este QR ya fue validado previamente</span>
        </p>
      </div>
      
      <div class="notificacion-mensaje" *ngIf="!resultado.detalles">
        <p>{{ resultado.message || resultado.error }}</p>
      </div>

      <button class="btn-aceptar-notificacion" (click)="cerrarNotificacion()">
        {{ resultado.code === 'TICKET_VALIDATED' ? 'âœ“ ACEPTAR' : 'CONTINUAR' }}
      </button>
    </div>
  </div>

  <!-- HISTORIAL -->
  <section class="historial" *ngIf="historial.length > 0">
    <h2>ğŸ“‹ Ãšltimas Validaciones</h2>
    <div class="historial-lista">
      <div 
        class="historial-item" 
        *ngFor="let item of historial.slice(0, 10)"
        [ngClass]="{ 'validada': item.code === 'TICKET_VALIDATED' }"
      >
        <div class="historial-icono">{{ item.code === 'TICKET_VALIDATED' ? 'âœ…' : 'âš ï¸' }}</div>
        <div class="historial-info">
          <div class="historial-ticket">{{ item.ticketId }}</div>
          <div class="historial-cliente" *ngIf="item.detalles">
            {{ item.detalles.nombreCliente }} - {{ item.detalles.totalEntradas }} entrada(s)
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MODO ESCANEO QR ya no es necesario, se maneja arriba -->
</div>
